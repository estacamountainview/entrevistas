<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>Entrevistas</title>

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&display=swap");

      :root {
        --bg: #f7f7f8;
        --card: #ffffff;
        --text: #111827;
        --muted: #6b7280;
        --line: #e5e7eb;
        --accent: #2f6fed;
        --accent2: #255ad6;
        --danger: #b91c1c;
        --shadow: 0 12px 30px rgba(0, 0, 0, 0.08);
        --radius: 18px;
      }

      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: "Manrope", "Segoe UI", Arial, sans-serif;
        background:
          radial-gradient(
            1000px 480px at 20% -10%,
            rgba(47, 111, 237, 0.08),
            transparent 60%
          ),
          linear-gradient(180deg, #f9fafb 0%, #f3f4f6 100%);
        color: var(--text);
      }

      .page {
        min-height: 100vh;
        padding: 22px 14px 36px;
        display: flex;
        justify-content: center;
      }

      .container {
        width: 100%;
        max-width: 640px;
      }

      .card {
        background: var(--card);
        border: 1px solid var(--line);
        border-radius: 22px;
        box-shadow: 0 18px 50px rgba(17, 24, 39, 0.12);
        overflow: hidden;
      }

      .header {
        padding: 22px 20px 14px;
        border-bottom: 1px solid var(--line);
      }
      h1 {
        margin: 0;
        font-size: 24px;
        letter-spacing: 0.1px;
      }
      .sub {
        margin: 8px 0 0;
        color: var(--muted);
        font-size: 15px;
        line-height: 1.4;
      }

      form {
        padding: 18px 20px 20px;
      }

      .row {
        margin-bottom: 16px;
      }

      label {
        display: block;
        font-size: 15px;
        font-weight: 700;
        margin-bottom: 8px;
      }
      .req {
        color: var(--danger);
        margin-left: 4px;
      }

      /* Inputs large for older users */
      input,
      select {
        width: 100%;
        height: 54px;
        padding: 0 16px;
        border-radius: 14px;
        border: 1px solid #e6e7ec;
        background: #fff;
        font-size: 17px;
        color: var(--text);
        outline: none;
        transition:
          border-color 0.2s ease,
          box-shadow 0.2s ease,
          transform 0.2s ease;
      }

      input::placeholder {
        color: #9ca3af;
      }

      input:focus,
      select:focus {
        border-color: rgba(37, 99, 235, 0.55);
        box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.18);
        transform: translateY(-1px);
      }

      /* Make select arrow visible & comfortable on mobile */
      select {
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        padding-right: 44px;
        background-image:
          linear-gradient(45deg, transparent 50%, #6b7280 50%),
          linear-gradient(135deg, #6b7280 50%, transparent 50%),
          linear-gradient(to right, transparent, transparent);
        background-position:
          calc(100% - 22px) 22px,
          calc(100% - 16px) 22px,
          calc(100% - 44px) 0.6em;
        background-size:
          6px 6px,
          6px 6px,
          1px 2.6em;
        background-repeat: no-repeat;
      }

      .btn {
        width: 100%;
        height: 56px;
        border: none;
        border-radius: 14px;
        font-size: 18px;
        font-weight: 800;
        color: #fff;
        background: linear-gradient(180deg, var(--accent), var(--accent2));
        cursor: pointer;
        box-shadow: 0 14px 28px rgba(47, 111, 237, 0.22);
        transition:
          transform 0.15s ease,
          box-shadow 0.2s ease;
      }
      .btn:active {
        transform: translateY(1px);
      }
      .btn[disabled] {
        opacity: 0.65;
        cursor: not-allowed;
      }

      .msg {
        margin-top: 12px;
        font-size: 15px;
        color: var(--muted);
        min-height: 20px;
      }
      .msg.error {
        color: var(--danger);
        font-weight: 800;
        background: #fee2e2;
        border: 1px solid #fecaca;
        padding: 10px 12px;
        border-radius: 12px;
      }

      .footerNote {
        margin-top: 14px;
        font-size: 13px;
        color: var(--muted);
        line-height: 1.35;
        text-align: center;
      }

      /* Small phones */
      @media (max-width: 360px) {
        h1 {
          font-size: 20px;
        }
        input,
        select {
          font-size: 16px;
          height: 50px;
        }
        .btn {
          height: 52px;
          font-size: 17px;
        }
      }

      /* Tablets */
      @media (min-width: 720px) {
        .page {
          padding: 36px 28px 48px;
        }
        .container {
          max-width: 760px;
        }
        .header {
          padding: 26px 28px 18px;
        }
        form {
          padding: 22px 28px 28px;
        }
        h1 {
          font-size: 28px;
        }
        .sub {
          font-size: 16px;
        }
      }
    </style>
  </head>

  <body>
    <main class="page">
      <div class="container">
        <section class="card">
          <header class="header">
            <h1>Entrevistas con la Presidencia de Estaca</h1>
            <!-- <p class="sub">
              Programe su entrevista con la presidencia de estaca llenando el
              siguiente formulario. Después de enviarlo, será redirigido al
              calendario para seleccionar la fecha y hora disponibles.
            </p> -->
          </header>

          <form id="form" novalidate>
            <div class="row">
              <label>Nombre <span class="req">*</span></label>
              <input type="text" name="first_name" required />
            </div>

            <div class="row">
              <label>Apellido <span class="req">*</span></label>
              <input type="text" name="last_name" required />
            </div>

            <div class="row">
              <label>Correo electrónico <span class="req">*</span></label>
              <input
                type="email"
                name="email"
                placeholder="nombre@email.com"
                required
              />
            </div>

            <div class="row">
              <label>Número de teléfono <span class="req">*</span></label>
              <input
                type="tel"
                name="phone"
                placeholder="Ej. 8015551234"
                inputmode="numeric"
                pattern="[0-9]{10}"
                maxlength="10"
                required
              />
            </div>

            <div class="row">
              <label>Barrio <span class="req">*</span></label>
              <select name="barrio" required>
                <option value="">Seleccione…</option>
                <option>Vineyard 7</option>
                <option>Sharon Park 13</option>
                <option>Springwater 3</option>
                <option>Suncrest 8</option>
                <option>Lakeview 11</option>
                <option>Geneva Heights 1</option>
                <option>Cherry Hill 8</option>
                <option>Hillcrest 9</option>
              </select>
            </div>

            <div class="row">
              <label>Motivo de entrevista <span class="req">*</span></label>
              <select name="motivo" required>
                <option value="">Seleccione…</option>
                <option>Renovacion de recomendacion</option>
                <option>Ecclesiastical endorsement</option>
                <option>Futuro Misionero</option>
                <option>Primera vez entrando al templo</option>
                <option>Sellamiento</option>
                <option>Apartamiento pendiente</option>
                <option>Llamamiento / Reporte</option>
              </select>
            </div>

            <div class="row" id="llamamientoRow" style="display: none;">
              <label>Seleccione su llamamiento <span class="req">*</span></label>
              <select name="llamamiento">
                <option value="">Seleccione…</option>
                <option>Presidente de quorum de elderes</option>
                <option>Presidenta de sociedad de socorro de estaca</option>
              </select>
            </div>

            <button type="submit" id="submitBtn" class="btn">Continuar</button>

            <p id="msg" class="msg" role="status" aria-live="polite"></p>
          </form>
        </section>
      </div>
    </main>

    <script>
      const URL_A =
        "https://calendly.com/estacamountainview/entrevista-con-presidencia-de-estaca";
      const URL_B =
        "https://calendly.com/marteiduel/entrevista-con-presidente-de-estaca";

      function normalize(text) {
        return (text || "")
          .trim()
          .toLowerCase()
          .normalize("NFD")
          .replace(/[\u0300-\u036f]/g, "");
      }

      function buildUrl(baseUrl, params) {
        const qs = new URLSearchParams();
        for (const key in params) {
          const value = (params[key] || "").toString().trim();
          if (value) qs.set(key, value);
        }
        return qs.toString() ? baseUrl + "?" + qs.toString() : baseUrl;
      }

      // Bloquear letras en teléfono (incluye "e")
      const phoneInput = document.querySelector('input[name="phone"]');
      phoneInput.addEventListener("input", () => {
        phoneInput.value = phoneInput.value.replace(/[^0-9]/g, "");
      });

      const form = document.getElementById("form");
      const msg = document.getElementById("msg");
      const btn = document.getElementById("submitBtn");
      const llamamientoRow = document.getElementById("llamamientoRow");
      const motivoSelect = document.querySelector('select[name="motivo"]');
      const llamamientoSelect = document.querySelector(
        'select[name="llamamiento"]'
      );

      function toggleLlamamiento() {
        const show = normalize(motivoSelect.value) === normalize("Llamamiento / Reporte");
        llamamientoRow.style.display = show ? "block" : "none";
        llamamientoSelect.required = show;
        if (!show) {
          llamamientoSelect.value = "";
        }
      }

      motivoSelect.addEventListener("change", toggleLlamamiento);
      toggleLlamamiento();

      form.addEventListener("submit", function (e) {
        e.preventDefault();
        msg.textContent = "";
        msg.classList.remove("error");

        const data = new FormData(form);

        const first = (data.get("first_name") || "").trim();
        const last = (data.get("last_name") || "").trim();
        const email = (data.get("email") || "").trim();
        const phone = (data.get("phone") || "").trim();
        const barrio = (data.get("barrio") || "").trim();
        const motivo = (data.get("motivo") || "").trim();
        const llamamiento = (data.get("llamamiento") || "").trim();

        if (!first || !last || !email || !phone || !barrio || !motivo) {
          msg.textContent = "Por favor complete todos los campos.";
          msg.classList.add("error");
          return;
        }

        if (
          normalize(motivo) === normalize("Llamamiento / Reporte") &&
          !llamamiento
        ) {
          msg.textContent = "Por favor seleccione su llamamiento.";
          msg.classList.add("error");
          return;
        }

        if (!/^\d{10}$/.test(phone)) {
          msg.textContent =
            "El número de teléfono debe tener 10 números (sin espacios).";
          msg.classList.add("error");
          return;
        }

        if (!email.includes("@")) {
          msg.textContent = 'El correo debe incluir "@".';
          msg.classList.add("error");
          return;
        }

        const m = normalize(motivo);
        const goA =
          m === normalize("Renovacion de recomendacion") ||
          m === normalize("Ecclesiastical endorsement");

        const finalUrl = buildUrl(goA ? URL_A : URL_B, {
          name: first + " " + last,
          email: email,
          a1: "1" + phone,
          a2: barrio,
          a3: motivo,
          a4: llamamiento,
        });

        btn.disabled = true;
        msg.textContent = "Abriendo el calendario…";
        window.location.replace(finalUrl);
      });
    </script>
  </body>
</html>
